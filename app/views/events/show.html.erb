<h1><%= @event.title %></h1>

<p><strong>説明：</strong><br><%= simple_format(@event.description) %></p>

<p><strong>場所：</strong><%= @event.location %></p>
<p><strong>開始：</strong><%= @event.start_datetime.strftime("%Y-%m-%d %H:%M") %></p>
<p><strong>終了：</strong><%= @event.end_datetime.strftime("%Y-%m-%d %H:%M") %></p>

<% wish_count = Participation.where(event_id: @event.id, status: "favorite").count %>

<p>
  <strong>定員：</strong>
  <%= wish_count %> / <%= @event.capacity %> 名
</p>

<p><strong>カテゴリ：</strong><%= @event.category %></p>
<p><strong>主催者：</strong><%= @event.organizer %></p>

<% if @event.thumbnail_url.present? %>
  <p><img src="<%= @event.thumbnail_url %>" width="300"></p>
<% end %>

<hr>

<% participation =
     current_user &&
     Participation.find_by(user_id: current_user.id, event_id: @event.id)
%>

<% if participation.nil? %>

  <% if wish_count < @event.capacity %>
    <%= button_to "参加希望を送る",
          participations_path(event_id: @event.id),
          method: :post %>
  <% else %>
    <p style="color: red; font-weight: bold;">
      ※ 定員に達しました
    </p>
  <% end %>

<% elsif participation.status == "favorite" %>

  <p><strong>ステータス：</strong>参加希望</p>
  <%= button_to "参加キャンセル",
        participation_path(participation),
        method: :delete %>

<% elsif participation.status == "confirmed" %>

  <p><strong>ステータス：</strong>確定</p>

<% elsif participation.status == "canceled" %>

  <p><strong>ステータス：</strong>キャンセル済み</p>

  <% if wish_count < @event.capacity %>
    <%= button_to "再登録（参加希望）",
          participation_path(participation, status: "favorite"),
          method: :patch %>
  <% else %>
    <p style="color: red;">※ 定員オーバーのため再登録できません</p>
  <% end %>

<% end %>

<hr>

<% if logged_in? && (@event.creator_id == current_user.id || current_user.admin?) %>
  <p>
    <%= link_to "編集", edit_event_path(@event) %> |
    <%= link_to "削除", event_path(@event),
          data: { turbo_method: :delete, turbo_confirm: "本当に削除しますか？" } %>
  </p>
<% end %>

<p><%= link_to "一覧に戻る", events_path %></p>
